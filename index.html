<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Rifa Online</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  font-family: Arial, sans-serif;
  background: #f5f6f8;
  margin: 0;
  padding: 20px 20px 120px 20px;
}

.box {
  background: #fff;
  padding: 16px;
  border-radius: 8px;
  margin-bottom: 20px;
}

.numeros {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(70px, 1fr));
  gap: 8px;
}

.numero {
  border: 1px solid #ccc;
  padding: 12px 0;
  text-align: center;
  border-radius: 6px;
  cursor: pointer;
  font-weight: bold;
}

.numero.indisponivel {
  background: #ddd;
  color: #777;
  cursor: not-allowed;
}

.numero.selecionado {
  background: #4caf50;
  color: #fff;
  border-color: #4caf50;
}

label {
  display: block;
  margin-top: 12px;
  font-weight: bold;
}

input {
  width: 100%;
  padding: 10px;
  margin-top: 4px;
  border-radius: 6px;
  border: 1px solid #ccc;
}

.footer-fixo {
  position: fixed;
  bottom: 0;
  left: 0;
  width: 100%;
  background: #ffffff;
  border-top: 1px solid #ddd;
  padding: 12px;
  box-shadow: 0 -2px 6px rgba(0,0,0,.08);
}

.footer-fixo button {
  max-width: 420px;
  margin: 0 auto;
  display: block;
  width: 100%;
  padding: 14px;
  font-size: 16px;
  border: none;
  border-radius: 6px;
  background: #1976d2;
  color: #fff;
  cursor: pointer;
}

.footer-fixo button:disabled {
  background: #aaa;
}
</style>
</head>

<body>

<div class="box">
  <h1>Rifa Online</h1>
  <p><strong>Valor por número:</strong> R$ 3,00</p>
  <p><strong>Prêmio:</strong> (a definir)</p>
  <p><strong>Data do sorteio:</strong> (a definir)</p>
</div>

<div class="box">
  <h2>Dados do comprador</h2>

  <label>Nome completo</label>
  <input id="nome" type="text" required>

  <label>Email</label>
  <input id="email" type="email" required>

  <label>Telefone (somente números – ex: 84981677500)</label>
  <input id="telefone" type="text" pattern="[0-9]{11}" placeholder="84981677500" required>
</div>

<h2>Escolha seus números</h2>
<div id="lista" class="numeros"></div>

<div class="footer-fixo">
  <button id="finalizar" disabled>Finalizar compra</button>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbzXI3JcHzQ-GqB0jQHP1G4HkjHLZurpDenWlu3HvPqVaABD3klGadYf9jzrhyFtlraGlQ/exec";

const FORM_URL = "https://docs.google.com/forms/d/e/1FAIpQLSc-GWBmH84HEi0byarZdcTYZW2I_lKdsLnKqOZiI-wezlk5FQ/viewform";

const ENTRY_NUMEROS = "entry.80231626";
const ENTRY_NOME = "entry.1960355039";
const ENTRY_EMAIL = "entry.332784604";
const ENTRY_TEL = "entry.857723668";

const TOTAL = 1000;
const indisponiveis = new Set();
const selecionados = new Set();

function pad4(n) {
  return String(n).padStart(4, "0");
}

document.addEventListener("DOMContentLoaded", async () => {
  criarNumeros();
  await carregarIndisponiveis();
});

function criarNumeros() {
  const lista = document.getElementById("lista");

  for (let i = 0; i <= TOTAL; i++) {
    const div = document.createElement("div");
    div.className = "numero";
    div.textContent = pad4(i);
    div.dataset.numero = i;

    div.onclick = () => alternar(i, div);
    lista.appendChild(div);
  }
}

async function carregarIndisponiveis() {
  const r = await fetch(API_URL, { cache: "no-store" });
  const data = await r.json();

  data.forEach(linha => {
    const campo = linha["Números"];
    if (!campo) return;

    campo.split(",").forEach(n => {
      const num = Number(n.trim());
      if (!isNaN(num)) indisponiveis.add(num);
    });
  });

  document.querySelectorAll(".numero").forEach(el => {
    const n = Number(el.dataset.numero);
    if (indisponiveis.has(n)) {
      el.classList.add("indisponivel");
      el.onclick = null;
    }
  });
}

function alternar(num, el) {
  if (indisponiveis.has(num)) return;

  if (selecionados.has(num)) {
    selecionados.delete(num);
    el.classList.remove("selecionado");
  } else {
    selecionados.add(num);
    el.classList.add("selecionado");
  }

  document.getElementById("finalizar").disabled = selecionados.size === 0;
}

document.getElementById("finalizar").addEventListener("click", () => {
  const nome = document.getElementById("nome").value.trim();
  const email = document.getElementById("email").value.trim();
  const tel = document.getElementById("telefone").value.trim();

  if (!nome || !email || !tel) {
    alert("Preencha todos os dados do comprador.");
    return;
  }

  const lista = [...selecionados].map(pad4).join(", ");

  const url = `${FORM_URL}?${ENTRY_NUMEROS}=${encodeURIComponent(lista)}&${ENTRY_NOME}=${encodeURIComponent(nome)}&${ENTRY_EMAIL}=${encodeURIComponent(email)}&${ENTRY_TEL}=${encodeURIComponent(tel)}`;

  window.location.href = url;
});
</script>

</body>
</html>
