<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Rifa Online</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  font-family: Arial, sans-serif;
  background: #f5f6f8;
  margin: 0;
  padding: 20px;
}

.box {
  background: #fff;
  padding: 16px;
  border-radius: 8px;
  margin-bottom: 20px;
}

.numeros {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(70px, 1fr));
  gap: 8px;
}

.numero {
  border: 1px solid #ccc;
  padding: 12px 0;
  text-align: center;
  border-radius: 6px;
  cursor: pointer;
  font-weight: bold;
}

.numero.indisponivel {
  background: #ddd;
  color: #777;
  cursor: not-allowed;
}

.numero.selecionado {
  background: #4caf50;
  color: #fff;
  border-color: #4caf50;
}

button {
  width: 100%;
  padding: 14px;
  font-size: 16px;
  border: none;
  border-radius: 6px;
  background: #1976d2;
  color: #fff;
  cursor: pointer;
}

button:disabled {
  background: #aaa;
}
</style>
</head>

<body>

<div class="box">
  <h1>Rifa Online</h1>
  <p><strong>Valor por número:</strong> R$ 3,00</p>
</div>

<h2>Escolha seus números</h2>
<div id="lista" class="numeros"></div>

<button id="finalizar" disabled>Finalizar compra</button>

<script>
/* ================= CONFIG ================= */

const API_URL =
"https://script.google.com/macros/s/AKfycbzXI3JcHzQ-GqB0jQHP1G4HkjHLZurpDenWlu3HvPqVaABD3klGadYf9jzrhyFtlraGlQ/exec";

const FORM_URL =
"https://docs.google.com/forms/d/e/1FAIpQLSc-GWBmH84HEi0byarZdcTYZW2I_lKdsLnKqOZiI-wezlk5FQ/viewform";

const ENTRY_NUMEROS = "entry.80231626";

/* ========================================== */

const TOTAL = 1000;
const indisponiveis = new Set();
const selecionados = new Set();

function pad4(n) {
  return String(n).padStart(4, "0");
}

document.addEventListener("DOMContentLoaded", async () => {
  criarNumeros();
  await carregarIndisponiveis();
});

function criarNumeros() {
  const lista = document.getElementById("lista");

  for (let i = 0; i <= TOTAL; i++) {
    const div = document.createElement("div");
    div.className = "numero";
    div.textContent = pad4(i);
    div.dataset.numero = i;

    div.onclick = () => alternar(i, div);
    lista.appendChild(div);
  }
}

async function carregarIndisponiveis() {
  const r = await fetch(API_URL, { cache: "no-store" });
  const data = await r.json();

  data.forEach(linha => {
    const campo = linha["Números"];
    if (!campo) return;

    campo.split(",").forEach(n => {
      const num = Number(n.trim());
      if (!isNaN(num)) indisponiveis.add(num);
    });
  });

  document.querySelectorAll(".numero").forEach(el => {
    const n = Number(el.dataset.numero);
    if (indisponiveis.has(n)) {
      el.classList.add("indisponivel");
      el.onclick = null;
    }
  });
}

function alternar(num, el) {
  if (indisponiveis.has(num)) return;

  if (selecionados.has(num)) {
    selecionados.delete(num);
    el.classList.remove("selecionado");
  } else {
    selecionados.add(num);
    el.classList.add("selecionado");
  }

  document.getElementById("finalizar").disabled =
    selecionados.size === 0;
}

/* ===== REDIRECIONAMENTO REAL ===== */

document.getElementById("finalizar").addEventListener("click", () => {
  const lista = [...selecionados].map(pad4).join(", ");

  const url =
    `${FORM_URL}?${ENTRY_NUMEROS}=${encodeURIComponent(lista)}`;

  window.location.assign(url);
});
</script>

</body>
</html>
